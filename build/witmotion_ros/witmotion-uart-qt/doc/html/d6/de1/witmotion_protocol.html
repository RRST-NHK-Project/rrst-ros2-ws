<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Witmotion IMU Library: Unified Witmotion communication protocol</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/SVG"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Witmotion IMU Library<span id="projectnumber">&#160;1.2.28~dev_5c2e86d</span>
   </div>
   <div id="projectbrief">Open source UART communication library for sensor devices manufactured by WitMotion Shenzhen Co.,Ltd</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d6/de1/witmotion_protocol.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Unified Witmotion communication protocol</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The communication protocol for all known Witmotion IMU sensor devices is unified. It bases on TTL UART communication circuits. Please refer to <a class="el" href="../../df/d09/witmotion_docs.html">official documentation</a> for complete description. UART initiates connection on the baudrate which should be already set in the sensor's memory.</p>
<h1><a class="anchor" id="autotoc_md8"></a>
Connection mode</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Parameter   </th><th class="markdownTableHeadNone">Value   </th><th class="markdownTableHeadNone"><code>QSerialPort</code> config constant    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Port mode</b>   </td><td class="markdownTableBodyNone">Full Duplex   </td><td class="markdownTableBodyNone"><code>QSerialPort::Direction::AllDirections</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>Start Bit</b>   </td><td class="markdownTableBodyNone">0   </td><td class="markdownTableBodyNone"><code>0x00</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Stop Bit</b>   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone"><code>QSerialPort::OneStop</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>Hardware Flow Control</b>   </td><td class="markdownTableBodyNone">Off   </td><td class="markdownTableBodyNone"><code>QSerialPort::FlowControl::NoFlowControl</code>   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md9"></a>
Supported baud rates</h2>
<p>The known sensors support the following baud rates (the non-standard rates unsupported in <code>QSerialPort</code> are noticed with <em>italic</em>):</p><ul>
<li>2400</li>
<li>4800</li>
<li>9600 (default for open-circuit devices),</li>
<li>19200</li>
<li>38400</li>
<li>57600</li>
<li>115200 (default for enclosed devices with built-in USB/TTL transceiver)</li>
<li><em>230400</em></li>
<li><em>256000</em></li>
<li><em>460800</em></li>
<li><em>921600</em> <dl class="section note"><dt>Note</dt><dd>The non-standard baudrated are not supported officially by <code>QSerialPort</code> backend. However, the <a href="https://github.com/ElettraSciComp/witmotion_IMU_ros/issues/20#issuecomment-1369174406">official Windows controller application</a> by Witmotion allows to set up the device with these values. If this would be occasionally done, the Qt backend cannot connect to the device, and the user is strongly advised to reduce baud rate via the same Windows controller application to 115200 baud manually before proceed.</dd></dl>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md10"></a>
Packet structures</h1>
<p>The device throws out the <em>data packets</em> containing the measured values and accepts <em>configuration packets</em> to set up the parameters on-the-fly. The internal data representations for both types of packets are unified. For actual declarations refer to <a class="el" href="../../d9/d49/types_8h.html">types.h</a> header file.</p>
<h2><a class="anchor" id="autotoc_md11"></a>
Output data packet</h2>
<p>The output data are organized in 11-byte sequential packets by the following principle: </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Offset   </th><th class="markdownTableHeadNone">Length   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>0x00</code>   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Magic header key, <a class="el" href="../../dc/ddc/namespacewitmotion.html#a637c861a28f4015a1b57d8bd9ef08cbf">WITMOTION_HEADER_BYTE</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>0x01</code>   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Data type ID, as defined in <a class="el" href="../../dc/ddc/namespacewitmotion.html#a5fdb17b12d46f0ec17e44a1dab9957d3">witmotion_packet_id</a>. All supported packet IDs should be enumerated in <a class="el" href="../../dc/ddc/namespacewitmotion.html#a90712081209bb40591c1666a5a5362e5">witmotion_registered_ids</a> list and described in <a class="el" href="../../dc/ddc/namespacewitmotion.html#a4af000309f5694300ababe3086c486fc">witmotion_packet_descriptions</a> map in <a class="el" href="../../d9/d49/types_8h.html">types.h</a> header file, otherwise the library will not consider it as available to support.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>0x02</code>   </td><td class="markdownTableBodyNone">8   </td><td class="markdownTableBodyNone">Payload. The payload is organized as sequential byte array wrapped into C-style union. It can store: <br  />
 - 8 8-bit <em>signed</em> integers \( \left[ -127 ... 128 \right] \) <br  />
 - 8 8-bit <em>unsigned</em> integers \( \left[ 0 ... 255 \right] \) <br  />
 - 4 16-bit <em>signed</em> integers <br  />
 - 2 32-bit <em>signed</em> integers    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>0x0A</code>   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Validation CRC. Calculated as a result of summation over all the <b>bytes</b>, not elements, as <em>unsigned</em> integers: <br  />
 \( crc = \sum_{i=0}^{i &lt; 10}\times\)<code>reinterpret_cast&lt;uint8_t*&gt;(payload) + i</code>   </td></tr>
</table>
<p>The data packet structure is internally represented by <a class="el" href="../../dc/d8d/structwitmotion_1_1witmotion__datapacket.html">witmotion_datapacket</a> structure.</p>
<h2><a class="anchor" id="autotoc_md12"></a>
Configuration data packet</h2>
<p>Configuration packets are 5-bytes sequential structures organized as it is shown in the following table. CRC check is not implemented on the device. </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Offset   </th><th class="markdownTableHeadNone">Length   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>0x00</code>   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Magic header key, <a class="el" href="../../dc/ddc/namespacewitmotion.html#a856c58401c1ba5c7d8a9f58f31f2b83f">WITMOTION_CONFIG_HEADER</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>0x01</code>   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Magic configuration packet ID, <a class="el" href="../../dc/ddc/namespacewitmotion.html#aac88381210eb4ab56eba64da7ae8c29c">WITMOTION_CONFIG_KEY</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>0x02</code>   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Register ID, as defined in <a class="el" href="../../dc/ddc/namespacewitmotion.html#a2a0798fb689894f2b7f998303bd8a4b3">witmotion_config_register_id</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>0x03</code>   </td><td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">Payload. The set of 1 or 2 values that should be set on the device, represented as two 8-bit or one 16-bit unsigned integer   </td></tr>
</table>
<p>The configuration packet has an internal representation in <a class="el" href="../../d1/d6d/structwitmotion_1_1witmotion__config__packet.html">witmotion_config_packet</a> structure.</p>
<h1><a class="anchor" id="autotoc_md13"></a>
Data decoding algorithms and decoder functions</h1>
<p>The type-specific descriptions for payload components encapsulated in output data packet, are placed in <a class="el" href="../../dc/ddc/namespacewitmotion.html#a5fdb17b12d46f0ec17e44a1dab9957d3">witmotion_packet_id</a> enumeration documentation. The component decoder functions and packet parsers are located in <a class="el" href="../../d8/d3c/util_8h.html">util.h</a> header file. In the following table the actual measurements are enumerated with corresponding decoding rules and output types. The rules are defined here only for the cases when the special decoding is needed. Otherwise the values should be interpreted exactly as they are defined in <a class="el" href="../../dc/ddc/namespacewitmotion.html#a5fdb17b12d46f0ec17e44a1dab9957d3">witmotion_packet_id</a> via direct copy.</p>
<p>Here and below, \( V \) is the <b>measured</b> value obtained from the device, \( D \) - <b>decoded</b> value, de-normalized from the sensor output. </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Value   </th><th class="markdownTableHeadNone">Unit   </th><th class="markdownTableHeadNone">Decoding rule   </th><th class="markdownTableHeadNone">Output type    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Acceleration   </td><td class="markdownTableBodyNone">\( m/s^2 \)   </td><td class="markdownTableBodyNone">\( D = 16\frac{V}{32768} \times 9.81 \)   </td><td class="markdownTableBodyNone">float    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Angular velocity   </td><td class="markdownTableBodyNone">\( rad/s \)   </td><td class="markdownTableBodyNone">\( D = \frac{V}{32768} \times 2000 \)   </td><td class="markdownTableBodyNone">float    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Euler angle   </td><td class="markdownTableBodyNone">\( deg \)   </td><td class="markdownTableBodyNone">\( D = \frac{V}{32768} \times 180 \)   </td><td class="markdownTableBodyNone">float    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Temperature   </td><td class="markdownTableBodyNone">\( ^{\circ}C \)   </td><td class="markdownTableBodyNone">\( D = \frac{V}{100} \)   </td><td class="markdownTableBodyNone">float    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Quaternion component   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">\( D = \frac{V}{32768} \)   </td><td class="markdownTableBodyNone">float    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Altimetry   </td><td class="markdownTableBodyNone">\( m \)   </td><td class="markdownTableBodyNone">\( D = \frac{V}{100} \)   </td><td class="markdownTableBodyNone">float    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">GPS coordinate, rough/degrees part   </td><td class="markdownTableBodyNone">\( deg \)   </td><td class="markdownTableBodyNone">\( D = \frac{V}{10^8} \)   </td><td class="markdownTableBodyNone">double-precision float    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">GPS coordinate, fine/minute part   </td><td class="markdownTableBodyNone">\( min \)   </td><td class="markdownTableBodyNone">\( D = \frac{V \mod 10^7}{10^5} \)   </td><td class="markdownTableBodyNone">double-precision float    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">GPS altimetry   </td><td class="markdownTableBodyNone">\( m \)   </td><td class="markdownTableBodyNone">\( D = \frac{V}{10} \)   </td><td class="markdownTableBodyNone">float    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">GPS angular velocity   </td><td class="markdownTableBodyNone">\( rad/s \)   </td><td class="markdownTableBodyNone">\( D = \frac{V}{10} \)   </td><td class="markdownTableBodyNone">float    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">GPS ground speed   </td><td class="markdownTableBodyNone">\( m/s \)   </td><td class="markdownTableBodyNone">\( D = \frac{V}{10^3} \)   </td><td class="markdownTableBodyNone">double-precision float   </td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd>Some values like temperature, require different coefficients on different sensors. These values require linear calibration. If you encounter this situation, please do not hesitate to open an <a href="https://github.com/ElettraSciComp/witmotion_IMU_QT/issues">issue</a>. </dd></dl>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Feb 17 2025 17:07:52 for Witmotion IMU Library by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
